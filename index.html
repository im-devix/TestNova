<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Nova - Premium Quiz Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6C5CE7; /* Royal purple */
            --primary-light: #A29BFE;
            --primary-dark: #5649C0;
            --secondary: #00CEC9; /* Teal */
            --secondary-dark: #00A8A5;
            --accent: #FD79A8; /* Pink */
            --success: #00B894;
            --danger: #D63031;
            --warning: #FDCB6E;
            --info: #0984E3;
            --light: #FFFFFF;
            --dark: #2D3436;
            --gray: #636E72;
            --light-gray: #DFE6E9;
            --bg-gradient: linear-gradient(135deg, #F9F9FF 0%, #F1F3FF 100%);
            --card-bg: rgba(255, 255, 255, 0.98);
            --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 15px 40px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --border-radius-xl: 30px;
            --transition: all 0.35s cubic-bezier(0.16, 1, 0.3, 1);
            --text-gradient: linear-gradient(135deg, var(--primary), var(--accent));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-gradient);
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            margin: 0 auto;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* ===== Pages ===== */
        .page {
            display: none;
            flex: 1;
            width: 100%;
            padding: 0;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        /* ===== Home Page ===== */
        #homePage {
            text-align: center;
            justify-content: center;
            align-items: center;
            padding: 24px;
            background: var(--bg-gradient);
            position: relative;
            overflow: hidden;
        }

        .home-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%236C5CE7' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .logo-container {
            margin-bottom: 40px;
            animation: slideUp 0.6s 0.1s both;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-size: 3.5rem;
            margin-bottom: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            background: var(--text-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Playfair Display', serif;
        }

        .logo i {
            font-size: 3rem;
            color: var(--accent);
        }

        .tagline {
            color: var(--gray);
            margin-bottom: 24px;
            font-size: 1.2rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            font-weight: 400;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 60px 0;
        }

        .feature-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(108, 92, 231, 0.1);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.1), rgba(253, 121, 168, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: var(--primary);
        }

        .feature-title {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
        }

        .feature-desc {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .cta-section {
            margin-top: 60px;
            padding: 40px;
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .cta-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .cta-title {
            font-size: 1.8rem;
            margin-bottom: 16px;
            color: var(--dark);
        }

        .cta-desc {
            color: var(--gray);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ===== Upload Page ===== */
        #uploadPage {
            text-align: center;
            justify-content: center;
            align-items: center;
            padding: 24px;
            background: var(--bg-gradient);
        }

        .upload-container {
            width: 100%;
            max-width: 600px;
            animation: slideUp 0.6s 0.2s both;
        }

        .file-upload {
            border: 2px dashed rgba(108, 92, 231, 0.3);
            border-radius: var(--border-radius-lg);
            padding: 50px 24px;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--card-bg);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .file-upload:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            opacity: 0;
            transition: var(--transition);
        }

        .file-upload:hover::before {
            opacity: 1;
        }

        .file-upload i {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .file-upload:hover i {
            transform: translateY(-5px);
            color: var(--primary-light);
        }

        .file-upload p {
            margin: 8px 0;
            color: var(--gray);
        }

        .file-upload p:first-of-type {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.2rem;
        }

        .file-input {
            display: none;
        }

        .btn-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            animation: slideUp 0.6s 0.3s both;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1rem;
            width: 100%;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
            opacity: 0;
            transition: var(--transition);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(108, 92, 231, 0.3);
            background: var(--primary-light);
        }

        .btn:hover::after {
            opacity: 1;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: rgba(108, 92, 231, 0.1);
        }

        .btn-secondary {
            background: var(--secondary);
            box-shadow: 0 10px 20px rgba(0, 206, 201, 0.2);
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
        }

        .btn-accent {
            background: var(--accent);
            box-shadow: 0 10px 20px rgba(253, 121, 168, 0.2);
        }

        .btn-accent:hover {
            background: #FC5C9C;
        }

        /* JSON Example */
        .json-example {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 24px;
            margin: 30px auto 0;
            max-width: 600px;
            width: 100%;
            box-shadow: var(--shadow-sm);
            text-align: left;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            display: none;
            border: 1px solid rgba(108, 92, 231, 0.1);
            animation: fadeIn 0.5s;
        }

        .json-example pre {
            margin: 0;
            white-space: pre-wrap;
            color: var(--dark);
            line-height: 1.6;
        }

        .toggle-json {
            margin-top: 16px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .toggle-json:hover {
            color: var(--primary-dark);
        }

        .toggle-json i {
            transition: transform 0.3s ease;
        }

        .toggle-json.active i {
            transform: rotate(180deg);
        }

        /* Share Link Section */
        .share-section {
            display: none;
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            animation: fadeIn 0.5s;
        }

        .share-section.active {
            display: block;
        }

        .share-title {
            font-size: 1.1rem;
            margin-bottom: 16px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-title i {
            color: var(--accent);
        }

        .share-input-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .share-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        .share-btn {
            padding: 12px 16px;
            border-radius: var(--border-radius);
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .share-btn:hover {
            background: var(--secondary-dark);
        }

        .share-options {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .share-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            font-size: 1.1rem;
        }

        .share-option.facebook {
            background: #3B5998;
        }

        .share-option.twitter {
            background: #1DA1F2;
        }

        .share-option.whatsapp {
            background: #25D366;
        }

        .share-option.email {
            background: var(--gray);
        }

        .share-option:hover {
            transform: translateY(-3px);
        }

        /* ===== Quiz Preview Modal ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(45, 52, 54, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
            padding: 24px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 32px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            animation: modalIn 0.4s;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        @keyframes modalIn {
            from { transform: translateY(20px) scale(0.98); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .modal-header {
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .modal-header i {
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-header h2 {
            color: var(--dark);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .quiz-info {
            text-align: left;
            margin: 24px 0;
            background: rgba(108, 92, 231, 0.03);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(108, 92, 231, 0.1);
        }

        .quiz-info div {
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(108, 92, 231, 0.1);
        }

        .quiz-info span:first-child {
            font-weight: 600;
            color: var(--dark);
        }

        .quiz-info span:last-child {
            color: var(--gray);
            text-align: right;
        }

        .modal-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* ===== Quiz Page ===== */
        #quizPage {
            padding: 0;
            background: var(--light);
        }

        .quiz-header {
            padding: 16px 24px;
            background: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .quiz-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .quiz-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .timer {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(108, 92, 231, 0.2);
        }

        .timer i {
            font-size: 0.9rem;
        }

        .progress-container {
            height: 6px;
            background: var(--light-gray);
            width: 100%;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .question-container {
            padding: 24px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 32px;
            line-height: 1.5;
            color: var(--dark);
        }

        .options-container {
            margin: 0 0 20px;
            flex: 1;
        }

        .option {
            padding: 20px 16px;
            margin: 12px 0;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            background: var(--light);
            box-shadow: 0 5px 10px rgba(0,0,0,0.03);
        }

        .option:hover {
            background: rgba(108, 92, 231, 0.03);
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .option.selected {
            background: rgba(108, 92, 231, 0.05);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(0, 184, 148, 0.05);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(214, 48, 49, 0.05);
            border-color: var(--danger);
        }

        .option-number {
            width: 40px;
            height: 40px;
            background: var(--light-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-weight: 600;
            transition: var(--transition);
            flex-shrink: 0;
            color: var(--gray);
        }

        .option.selected .option-number {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .option.correct .option-number {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-number {
            background: var(--danger);
            color: white;
        }

        .navigation {
            display: flex;
            gap: 16px;
            padding: 20px;
            background: var(--light);
            box-shadow: 0 -2px 15px rgba(0,0,0,0.05);
            position: sticky;
            bottom: 0;
        }

        .navigation .btn {
            flex: 1;
            justify-content: center;
            padding: 16px;
        }

        /* ===== Results Page ===== */
        #resultPage {
            padding: 0;
            background: var(--light);
            text-align: center;
            position: relative;
        }

        .result-header {
            padding: 80px 24px 100px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            position: relative;
            overflow: hidden;
        }

        .result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd' opacity='0.1'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .result-header h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
        }

        .result-header h1 i {
            background: linear-gradient(135deg, var(--accent), #FFC300);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .result-header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .result-content {
            padding: 0 24px 40px;
            margin-top: -60px;
            position: relative;
            z-index: 2;
        }

        .score-container {
            position: relative;
            margin-bottom: 40px;
        }

        .score-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: conic-gradient(var(--secondary) 0%, var(--light-gray) 0%);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            position: relative;
            box-shadow: var(--shadow-lg);
            transition: background 1s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .score-inner {
            width: 180px;
            height: 180px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
            position: relative;
        }

        .score-inner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 0 10px rgba(0, 206, 201, 0.1);
        }

        .score-percent {
            font-size: 3rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1;
        }

        .score-text {
            font-size: 1.1rem;
            color: var(--gray);
            margin-top: 8px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 40px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat {
            background: var(--light);
            padding: 20px 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .stat:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 500;
        }

        .correct .stat-value {
            color: var(--success);
        }

        .incorrect .stat-value {
            color: var(--danger);
        }

        .unattempted .stat-value {
            color: var(--warning);
        }

        /* Charts Section */
        .charts-section {
            margin: 40px 0;
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-sm);
        }

        .chart-container {
            margin: 30px 0;
            position: relative;
            height: 300px;
        }

        /* ===== Enhanced Question Review ===== */
        .review-section {
            margin-top: 40px;
            text-align: left;
            padding: 0 12px;
        }

        .review-title {
            font-size: 1.5rem;
            margin-bottom: 24px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--light-gray);
            font-weight: 600;
        }

        .review-title i {
            color: var(--primary);
        }

        .review-item {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .review-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .review-item.correct {
            border-left-color: var(--success);
        }

        .review-item.incorrect {
            border-left-color: var(--danger);
        }

        .review-item.unattempted {
            border-left-color: var(--warning);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--dark);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 1.1rem;
        }

        .review-question-number {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .review-answer {
            margin: 12px 0;
            padding-left: 40px;
            position: relative;
            color: var(--gray);
            font-size: 1rem;
        }

        .review-answer::before {
            content: '→';
            position: absolute;
            left: 20px;
            color: var(--gray);
        }

        .review-correct-answer {
            color: var(--success);
            font-weight: 600;
            padding-left: 40px;
            margin-top: 12px;
            position: relative;
            font-size: 1rem;
        }

        .review-correct-answer::before {
            content: '✓';
            position: absolute;
            left: 20px;
        }

        .answer-icon {
            margin-right: 8px;
        }

        .result-actions {
            padding: 24px;
            margin-top: 24px;
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ===== Responsive ===== */
        @media (max-width: 1024px) {
            .features {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 2.8rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
            
            .option {
                padding: 18px;
            }
            
            .stats {
                grid-template-columns: 1fr;
                max-width: 300px;
            }
            
            .score-circle {
                width: 200px;
                height: 200px;
            }
            
            .score-inner {
                width: 160px;
                height: 160px;
            }
            
            .score-percent {
                font-size: 2.5rem;
            }

            .result-actions {
                flex-direction: column;
            }

            .result-actions .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .page {
                padding: 0;
            }
            
            #homePage, #uploadPage {
                padding: 20px;
            }
            
            .logo {
                font-size: 2.2rem;
                gap: 10px;
            }
            
            .logo i {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .feature-card {
                padding: 20px;
            }
            
            .feature-icon {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .file-upload {
                padding: 30px 20px;
            }
            
            .quiz-header, .navigation {
                padding: 14px 16px;
            }
            
            .question-container {
                padding: 20px 16px;
            }
            
            .question-text {
                font-size: 1.2rem;
                margin-bottom: 24px;
            }
            
            .navigation {
                gap: 12px;
            }
            
            .btn {
                padding: 16px;
                font-size: 0.95rem;
            }
            
            .modal-content {
                padding: 24px 20px;
            }
            
            .modal-actions {
                flex-direction: column;
                gap: 12px;
            }
            
            .result-header h1 {
                font-size: 2rem;
            }
            
            .result-header p {
                font-size: 1rem;
            }
            
            .result-content {
                padding: 0 16px 30px;
                margin-top: -50px;
            }
            
            .score-circle {
                width: 180px;
                height: 180px;
            }
            
            .score-inner {
                width: 150px;
                height: 150px;
            }
            
            .score-percent {
                font-size: 2.2rem;
            }
            
            .review-title {
                font-size: 1.3rem;
            }

            .share-input-container {
                flex-direction: column;
            }

            .share-input {
                width: 100%;
            }

            .share-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="hero-bg"></div>
            <div class="home-container">
                <div class="logo-container">
                    <div class="logo">
                        <i class="fas fa-star"></i>
                        <span>Test Nova</span>
                    </div>
                    <p class="tagline">The premium platform for creating and taking beautiful, interactive quizzes with advanced analytics</p>
                </div>
                
                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <h3 class="feature-title">Elegant Design</h3>
                        <p class="feature-desc">Experience a visually stunning interface with smooth animations and premium aesthetics.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <h3 class="feature-title">Easy Sharing</h3>
                        <p class="feature-desc">Generate shareable links to distribute your quizzes with just one click.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <h3 class="feature-title">Detailed Analytics</h3>
                        <p class="feature-desc">Get comprehensive insights with beautiful charts and performance metrics.</p>
                    </div>
                </div>
                
                <div class="cta-section">
                    <h3 class="cta-title">Ready to Create Your Quiz?</h3>
                    <p class="cta-desc">Upload your quiz JSON file or try our sample quiz to experience Test Nova's premium features</p>
                    
                    <div class="action-buttons">
                        <button class="btn" id="createQuizBtn">
                            <i class="fas fa-plus"></i> Create Quiz
                        </button>
                        <button class="btn btn-secondary" id="trySampleBtn">
                            <i class="fas fa-star"></i> Try Sample
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Upload Page -->
        <div id="uploadPage" class="page">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Upload Quiz</span>
                </div>
                <p class="tagline">Upload your quiz JSON file or use our sample to get started</p>
            </div>
            
            <div class="upload-container">
                <div class="file-upload" id="dropZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & drop your quiz file</p>
                    <p><small>or click to browse</small></p>
                </div>
                <input type="file" id="fileInput" accept=".json" class="file-input">
            </div>
            
            <div class="btn-container">
                <button class="btn btn-secondary" id="useSampleBtn">
                    <i class="fas fa-star"></i> Try Sample Quiz
                </button>
                
                <div class="toggle-json" id="toggleJson">
                    <span>Show JSON Format</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div class="json-example" id="jsonExample">
                    <pre>{
  "title": "General Knowledge Quiz",
  "description": "Test your knowledge with these questions",
  "timeLimit": 5,
  "questions": [
    {
      "question": "What is the capital of France?",
      "options": ["London", "Paris", "Berlin", "Madrid"],
      "correctAnswer": 1
    },
    {
      "question": "Which planet is known as the Red Planet?",
      "options": ["Venus", "Mars", "Jupiter", "Saturn"],
      "correctAnswer": 1
    }
  ]
}</pre>
                </div>
                
                <div class="share-section" id="shareSection">
                    <h4 class="share-title"><i class="fas fa-share-alt"></i> Share This Quiz</h4>
                    <div class="share-input-container">
                        <input type="text" class="share-input" id="shareLinkInput" readonly>
                        <button class="share-btn" id="copyLinkBtn">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <div class="share-options">
                        <div class="share-option facebook" title="Share on Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </div>
                        <div class="share-option twitter" title="Share on Twitter">
                            <i class="fab fa-twitter"></i>
                        </div>
                        <div class="share-option whatsapp" title="Share on WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="share-option email" title="Share via Email">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quiz Preview Modal -->
        <div class="modal" id="quizPreviewModal">
            <div class="modal-content">
                <div class="modal-header">
                    <i class="fas fa-file-alt"></i>
                    <h2>Quiz Details</h2>
                </div>
                <div class="quiz-info" id="quizInfo"></div>
                <div class="modal-actions">
                    <button class="btn btn-outline" id="cancelQuizBtn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn" id="startQuizBtn">
                        <i class="fas fa-play"></i> Start Quiz
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Quiz Page -->
        <div id="quizPage" class="page">
            <div class="quiz-header">
                <div class="quiz-title" id="quizTitleHeader">Quiz Title</div>
                <div class="quiz-controls">
                    <div class="timer" id="timer">
                        <i class="fas fa-clock"></i> <span>00:00</span>
                    </div>
                    <div id="questionCount">1/10</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="questionText"></div>
                
                <div class="options-container" id="optionsContainer"></div>
            </div>
            
            <div class="navigation">
                <button class="btn btn-outline" id="prevQuestionBtn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn" id="nextQuestionBtn">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Results Page -->
        <div id="resultPage" class="page">
            <div class="result-header">
                <h1><i class="fas fa-trophy"></i> Quiz Results</h1>
                <p id="quizTitleResult">General Knowledge</p>
            </div>
            
            <div class="result-content">
                <div class="score-container">
                    <div class="score-circle" id="scoreCircle">
                        <div class="score-inner">
                            <div class="score-percent" id="scorePercent">0%</div>
                            <div class="score-text">Overall Score</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat correct">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat incorrect">
                        <div class="stat-value" id="incorrectCount">0</div>
                        <div class="stat-label">Incorrect Answers</div>
                    </div>
                    <div class="stat unattempted">
                        <div class="stat-value" id="unattemptedCount">0</div>
                        <div class="stat-label">Unattempted</div>
                    </div>
                </div>
                
                <div class="charts-section">
                    <h3 class="review-title"><i class="fas fa-chart-bar"></i> Performance Analysis</h3>
                    
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="timeChart"></canvas>
                    </div>
                </div>
                
                <div class="review-section">
                    <h3 class="review-title"><i class="fas fa-clipboard-list"></i> Question Review</h3>
                    <div id="questionReview"></div>
                </div>
                
                <div class="result-actions">
                    <button class="btn" id="restartBtn">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                    <button class="btn btn-secondary" id="shareResultsBtn">
                        <i class="fas fa-share-alt"></i> Share Results
                    </button>
                    <button class="btn btn-accent" id="printResultsBtn">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="btn btn-outline" id="backToHomeBtn">
                        <i class="fas fa-home"></i> Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const pages = {
            home: document.getElementById('homePage'),
            upload: document.getElementById('uploadPage'),
            quiz: document.getElementById('quizPage'),
            result: document.getElementById('resultPage')
        };
        
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const useSampleBtn = document.getElementById('useSampleBtn');
        const trySampleBtn = document.getElementById('trySampleBtn');
        const createQuizBtn = document.getElementById('createQuizBtn');
        const prevQuestionBtn = document.getElementById('prevQuestionBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const restartBtn = document.getElementById('restartBtn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const shareResultsBtn = document.getElementById('shareResultsBtn');
        const printResultsBtn = document.getElementById('printResultsBtn');
        const progressBar = document.getElementById('progressBar');
        const timerEl = document.getElementById('timer').querySelector('span');
        const quizPreviewModal = document.getElementById('quizPreviewModal');
        const quizInfoEl = document.getElementById('quizInfo');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const cancelQuizBtn = document.getElementById('cancelQuizBtn');
        const toggleJsonBtn = document.getElementById('toggleJson');
        const jsonExample = document.getElementById('jsonExample');
        const scoreCircle = document.getElementById('scoreCircle');
        const shareSection = document.getElementById('shareSection');
        const shareLinkInput = document.getElementById('shareLinkInput');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const quizTitleHeader = document.getElementById('quizTitleHeader');
        
        // Quiz Data
        let quizData = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 0;
        let startTime = 0;
        let timePerQuestion = [];
        let performanceChart = null;
        let timeChart = null;
        
        // Event Listeners
        fileInput.addEventListener('change', handleFileUpload);
        dropZone.addEventListener('click', () => fileInput.click());
        useSampleBtn.addEventListener('click', useSampleQuiz);
        trySampleBtn.addEventListener('click', useSampleQuiz);
        createQuizBtn.addEventListener('click', () => switchPage('upload'));
        prevQuestionBtn.addEventListener('click', showPreviousQuestion);
        nextQuestionBtn.addEventListener('click', showNextQuestion);
        restartBtn.addEventListener('click', restartQuiz);
        backToHomeBtn.addEventListener('click', () => switchPage('home'));
        shareResultsBtn.addEventListener('click', shareResults);
        printResultsBtn.addEventListener('click', printResults);
        startQuizBtn.addEventListener('click', startQuiz);
        cancelQuizBtn.addEventListener('click', () => quizPreviewModal.classList.remove('active'));
        toggleJsonBtn.addEventListener('click', toggleJsonExample);
        copyLinkBtn.addEventListener('click', copyShareLink);
        
        // Share buttons
        document.querySelectorAll('.share-option').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const type = e.currentTarget.classList.contains('facebook') ? 'facebook' :
                             e.currentTarget.classList.contains('twitter') ? 'twitter' :
                             e.currentTarget.classList.contains('whatsapp') ? 'whatsapp' : 'email';
                shareQuiz(type);
            });
        });
        
        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--primary)';
            dropZone.style.background = 'rgba(108, 92, 231, 0.05)';
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = 'rgba(108, 92, 231, 0.3)';
            dropZone.style.background = 'var(--card-bg)';
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'rgba(108, 92, 231, 0.3)';
            dropZone.style.background = 'var(--card-bg)';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload();
            }
        });
        
        // Functions
        function toggleJsonExample() {
            jsonExample.style.display = jsonExample.style.display === 'block' ? 'none' : 'block';
            toggleJsonBtn.classList.toggle('active');
        }
        
        function handleFileUpload() {
            const file = fileInput.files[0];
            if (!file) return;
            
            dropZone.innerHTML = '<i class="fas fa-spinner fa-spin"></i><p>Processing quiz file...</p>';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    quizData = JSON.parse(e.target.result);
                    generateShareLink();
                    showQuizPreview();
                } catch (error) {
                    alert("Error parsing JSON file. Please check the format and try again.");
                    resetDropZone();
                }
            };
            reader.onerror = function() {
                alert("Error reading file");
                resetDropZone();
            };
            reader.readAsText(file);
        }
        
        function resetDropZone() {
            dropZone.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop your quiz file</p>
                <p><small>or click to browse</small></p>
            `;
        }
        
        function generateShareLink() {
            if (!quizData) return;
            
            // In a real app, you would upload to a server and get a shareable link
            // For this demo, we'll use a fake URL with base64 encoded quiz data
            const quizString = JSON.stringify(quizData);
            const encodedQuiz = btoa(encodeURIComponent(quizString));
            const shareLink = `${window.location.origin}${window.location.pathname}?quiz=${encodedQuiz}`;
            
            shareLinkInput.value = shareLink;
            shareSection.classList.add('active');
        }
        
        function copyShareLink() {
            shareLinkInput.select();
            document.execCommand('copy');
            
            const originalText = copyLinkBtn.innerHTML;
            copyLinkBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            
            setTimeout(() => {
                copyLinkBtn.innerHTML = originalText;
            }, 2000);
        }
        
        function shareQuiz(type) {
            const link = shareLinkInput.value;
            const title = quizData ? quizData.title : 'Check out this quiz!';
            const text = quizData ? quizData.description || 'I created a quiz on Test Nova, try it out!' : 'Try this quiz on Test Nova!';
            
            let url;
            switch(type) {
                case 'facebook':
                    url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`;
                    break;
                case 'twitter':
                    url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(link)}`;
                    break;
                case 'whatsapp':
                    url = `https://wa.me/?text=${encodeURIComponent(`${text} ${link}`)}`;
                    break;
                case 'email':
                    url = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(`${text}\n\n${link}`)}`;
                    break;
            }
            
            window.open(url, '_blank');
        }
        
        function showQuizPreview() {
            quizInfoEl.innerHTML = `
                <div><span>Title:</span> <span>${quizData.title || 'Untitled Quiz'}</span></div>
                <div><span>Questions:</span> <span>${quizData.questions.length}</span></div>
                <div><span>Time:</span> <span>${quizData.timeLimit ? quizData.timeLimit + ' mins' : 'No limit'}</span></div>
                <div><span>Description:</span> <span>${quizData.description || 'No description'}</span></div>
            `;
            
            quizPreviewModal.classList.add('active');
            resetDropZone();
        }
        
        function useSampleQuiz() {
            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            
            setTimeout(() => {
                quizData = {
                    title: "Elite Knowledge Quiz",
                    description: "Test your elite knowledge with these premium questions",
                    timeLimit: 3,
                    questions: [
                        {
                            question: "What is the capital of France?",
                            options: ["London", "Paris", "Berlin", "Madrid"],
                            correctAnswer: 1
                        },
                        {
                            question: "Which planet is known as the Red Planet?",
                            options: ["Venus", "Mars", "Jupiter", "Saturn"],
                            correctAnswer: 1
                        },
                        {
                            question: "Who painted the Mona Lisa?",
                            options: ["Van Gogh", "Da Vinci", "Picasso", "Michelangelo"],
                            correctAnswer: 1
                        },
                        {
                            question: "What is the largest ocean on Earth?",
                            options: ["Atlantic", "Indian", "Arctic", "Pacific"],
                            correctAnswer: 3
                        },
                        {
                            question: "Which element has the chemical symbol 'O'?",
                            options: ["Gold", "Oxygen", "Osmium", "Oganesson"],
                            correctAnswer: 1
                        }
                    ]
                };
                
                generateShareLink();
                startQuiz();
                btn.innerHTML = originalText;
            }, 800);
        }
        
        function startQuiz() {
            quizPreviewModal.classList.remove('active');
            userAnswers = new Array(quizData.questions.length).fill(null);
            currentQuestionIndex = 0;
            timePerQuestion = new Array(quizData.questions.length).fill(0);
            startTime = Date.now();
            
            // Set quiz title in header
            quizTitleHeader.textContent = quizData.title || 'Quiz';
            
            // Set timer if available
            if (quizData.timeLimit) {
                timeLeft = quizData.timeLimit * 60;
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
            } else {
                timerEl.textContent = "No Limit";
                document.querySelector('.timer i').style.display = 'none';
            }
            
            showQuestion();
            switchPage('quiz');
        }
        
        function updateTimer() {
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showResults();
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timeLeft--;
        }
        
        function showQuestion() {
            // Record time spent on previous question
            if (currentQuestionIndex > 0) {
                const timeSpent = Math.floor((Date.now() - startTime) / 1000);
                timePerQuestion[currentQuestionIndex - 1] = timeSpent;
            }
            startTime = Date.now();
            
            const question = quizData.questions[currentQuestionIndex];
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / quizData.questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Update question counter
            document.getElementById('questionCount').textContent = 
                `${currentQuestionIndex + 1}/${quizData.questions.length}`;
            
            // Set question text
            document.getElementById('questionText').textContent = question.question;
            
            // Create options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                
                if (userAnswers[currentQuestionIndex] === i) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <div class="option-number">${String.fromCharCode(65 + i)}</div>
                    <div>${option}</div>
                `;
                
                optionElement.addEventListener('click', () => selectOption(i));
                optionsContainer.appendChild(optionElement);
            });
            
            // Update navigation buttons
            prevQuestionBtn.disabled = currentQuestionIndex === 0;
            
            // Update next button text and icon based on position
            const nextIcon = currentQuestionIndex === quizData.questions.length - 1 ? 
                '<i class="fas fa-check"></i>' : 
                '<i class="fas fa-arrow-right"></i>';
            
            nextQuestionBtn.innerHTML = currentQuestionIndex === quizData.questions.length - 1 ? 
                `Submit ${nextIcon}` : 
                `Next ${nextIcon}`;
        }
        
        function selectOption(optionIndex) {
            userAnswers[currentQuestionIndex] = optionIndex;
            showQuestion();
        }
        
        function showNextQuestion() {
            if (currentQuestionIndex < quizData.questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                // Smooth scroll to top of question
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                // Record time spent on last question
                const timeSpent = Math.floor((Date.now() - startTime) / 1000);
                timePerQuestion[currentQuestionIndex] = timeSpent;
                showResults();
            }
        }
        
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                // Smooth scroll to top of question
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function showResults() {
            clearInterval(timerInterval);
            
            // Calculate results
            let correct = 0;
            let incorrect = 0;
            let unattempted = 0;
            
            quizData.questions.forEach((q, i) => {
                if (userAnswers[i] === q.correctAnswer) {
                    correct++;
                } else if (userAnswers[i] !== null) {
                    incorrect++;
                } else {
                    unattempted++;
                }
            });
            
            const percentage = Math.round((correct / quizData.questions.length) * 100);
            
            // Display results
            document.getElementById('quizTitleResult').textContent = quizData.title || 'Quiz Results';
            document.getElementById('scorePercent').textContent = `${percentage}%`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('unattemptedCount').textContent = unattempted;
            
            // Animate score circle
            scoreCircle.style.background = `conic-gradient(var(--secondary) ${percentage}%, var(--light-gray) ${percentage}%)`;
            
            // Create charts
            createCharts(correct, incorrect, unattempted);
            
            // Show question review
            const reviewContainer = document.getElementById('questionReview');
            reviewContainer.innerHTML = '';
            
            quizData.questions.forEach((q, i) => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                
                if (userAnswers[i] === q.correctAnswer) {
                    reviewItem.classList.add('correct');
                } else if (userAnswers[i] !== null) {
                    reviewItem.classList.add('incorrect');
                } else {
                    reviewItem.classList.add('unattempted');
                }
                
                const userAnswerText = userAnswers[i] !== null ? q.options[userAnswers[i]] : 'Not answered';
                const correctAnswerText = q.options[q.correctAnswer];
                
                reviewItem.innerHTML = `
                    <div class="review-question">
                        <span class="review-question-number">${i + 1}</span>
                        <span>${q.question}</span>
                    </div>
                    <div class="review-answer">
                        <span class="answer-icon">${userAnswers[i] === q.correctAnswer ? '✓' : '✗'}</span>
                        Your answer: ${userAnswerText}
                    </div>
                    ${userAnswers[i] !== q.correctAnswer ? 
                      `<div class="review-correct-answer">Correct answer: ${correctAnswerText}</div>` : ''}
                    ${timePerQuestion[i] ? `<div class="review-time">Time spent: ${timePerQuestion[i]}s</div>` : ''}
                `;
                
                reviewContainer.appendChild(reviewItem);
            });
            
            switchPage('result');
        }
        
        function createCharts(correct, incorrect, unattempted) {
            // Destroy existing charts if they exist
            if (performanceChart) {
                performanceChart.destroy();
            }
            if (timeChart) {
                timeChart.destroy();
            }
            
            // Performance Chart (Pie)
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect', 'Unattempted'],
                    datasets: [{
                        data: [correct, incorrect, unattempted],
                        backgroundColor: [
                            'rgba(0, 184, 148, 0.8)',
                            'rgba(214, 48, 49, 0.8)',
                            'rgba(253, 203, 110, 0.8)'
                        ],
                        borderColor: [
                            'rgba(0, 184, 148, 1)',
                            'rgba(214, 48, 49, 1)',
                            'rgba(253, 203, 110, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
            
            // Time Spent Chart (Bar)
            const timeCtx = document.getElementById('timeChart').getContext('2d');
            timeChart = new Chart(timeCtx, {
                type: 'bar',
                data: {
                    labels: quizData.questions.map((q, i) => `Q${i + 1}`),
                    datasets: [{
                        label: 'Time Spent (seconds)',
                        data: timePerQuestion,
                        backgroundColor: timePerQuestion.map((time, i) => {
                            return userAnswers[i] === quizData.questions[i].correctAnswer ? 
                                'rgba(0, 184, 148, 0.8)' : 
                                userAnswers[i] !== null ? 
                                'rgba(214, 48, 49, 0.8)' : 
                                'rgba(253, 203, 110, 0.8)';
                        }),
                        borderColor: timePerQuestion.map((time, i) => {
                            return userAnswers[i] === quizData.questions[i].correctAnswer ? 
                                'rgba(0, 184, 148, 1)' : 
                                userAnswers[i] !== null ? 
                                'rgba(214, 48, 49, 1)' : 
                                'rgba(253, 203, 110, 1)';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Seconds'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Question Number'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const questionIndex = context.dataIndex;
                                    const question = quizData.questions[questionIndex];
                                    const userAnswer = userAnswers[questionIndex];
                                    let status;
                                    
                                    if (userAnswer === question.correctAnswer) {
                                        status = 'Correct';
                                    } else if (userAnswer !== null) {
                                        status = 'Incorrect';
                                    } else {
                                        status = 'Unattempted';
                                    }
                                    
                                    return `Status: ${status}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function shareResults() {
            const percentage = document.getElementById('scorePercent').textContent;
            const correct = document.getElementById('correctCount').textContent;
            const total = quizData.questions.length;
            const text = `I scored ${percentage} (${correct}/${total}) on the "${quizData.title}" quiz on Test Nova!`;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Quiz Results',
                    text: text,
                    url: url
                }).catch(err => {
                    console.log('Error sharing:', err);
                    fallbackShare(text, url);
                });
            } else {
                fallbackShare(text, url);
            }
        }
        
        function fallbackShare(text, url) {
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(shareUrl, '_blank');
        }
        
        function printResults() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Capture the result content as an image
            const resultContent = document.querySelector('.result-content');
            
            html2canvas(resultContent).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add new page if content is too long
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                doc.save('quiz-results.pdf');
            });
        }
        
        function restartQuiz() {
            fileInput.value = '';
            resetDropZone();
            switchPage('upload');
        }
        
        function switchPage(pageName) {
            // Hide all pages
            Object.values(pages).forEach(page => {
                page.classList.remove('active');
            });
            
            // Show the requested page
            pages[pageName].classList.add('active');
            
            // Scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Check for shared quiz in URL
        function checkForSharedQuiz() {
            const urlParams = new URLSearchParams(window.location.search);
            const quizParam = urlParams.get('quiz');
            
            if (quizParam) {
                try {
                    const decodedQuiz = decodeURIComponent(atob(quizParam));
                    quizData = JSON.parse(decodedQuiz);
                    switchPage('upload');
                    showQuizPreview();
                } catch (e) {
                    console.error('Error parsing shared quiz:', e);
                }
            }
        }
        
        // Initialize
        checkForSharedQuiz();
    </script>
</body>
</html>